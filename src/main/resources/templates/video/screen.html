<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
<style>
    .video-window{
        float: left;
        margin-left: 1%;
        margin-bottom: 1%;
        width: 350px;
        height: 150px;
        position: relative;
        background-color: #000;
    }
</style>

    <script th:src="@{../../plugins/cyberplayer/cyberplayer.js}"></script>
</head>
<body>
<div class="row col-sm-9">
    <table>
        <tr>
            <td>
                <div id="playercontainer1" class="video-window" alt="1" ></div>
            </td>
            <td>
                <div id="playercontainer2" class="video-window"  alt="2" ></div>
            </td>
            <td>
                <div id="playercontainer3" class="video-window"  alt="3" ></div>
            </td>
        </tr>
        <tr>
            <td>
                <div id="playercontainer4" class="video-window" alt="4" ></div>
            </td>
            <td>
                <div id="playercontainer5" class="video-window" alt="5" ></div>
            </td>
            <td>
                <div id="playercontainer6" class="video-window"  alt="6" ></div>
            </td>
        </tr>
        <tr>
            <td>
                <div id="playercontainer7" class="video-window" alt="7" ></div>
            </td>
            <td>
                <div id="playercontainer8" class="video-window" alt="8" ></div>
            </td>
            <td>
                <div id="playercontainer9" class="video-window"  alt="9" ></div>
            </td>
        </tr>
    </table>

</div>
<script>

     var current = 0;
     var size = 9;
     var playtable = new Array();
     var playerid = new Array();
     playtable[0] = 0;
     playtable[1] = 0;
     playtable[2] = 0;
     playtable[3] = 0;
     playtable[4] = 0;
     playtable[5] = 0;
     playtable[6] = 0;
     playtable[7] = 0;
     playtable[8] = 0;


     playerid[0] = 'playercontainer1';
     playerid[1] = 'playercontainer2';
     playerid[2] = 'playercontainer3';
     playerid[3] = 'playercontainer4';
     playerid[4] = 'playercontainer5';
     playerid[5] = 'playercontainer6';
     playerid[6] = 'playercontainer7';
     playerid[7] = 'playercontainer8';
     playerid[8] = 'playercontainer9';


     var currentPlay;

    function startplay( rtmpurl) {

         var wind = findUnused();
         var player = cyberplayer(wind).setup({
             width: 350,
             height: 150,
             file: rtmpurl, // <—rtmp直播地址
             autostart: true,
             stretching: "uniform",
             volume: 100,
             controls: true,
             controlbar: {
                 barLogo: false
             },
             rtmp: {
                 reconnecttime: 5, // rtmp直播的重连次数
                 bufferlength: 1 // 缓冲多少秒之后开始播放 默认1秒
             },
             ak: ""//"cc94de6803904f2ca7159eedeaced55d" // 公有云平台注册即可获得accessKey
            
         });

        player.onBeforeComplete( function () {
            console.log("结束播放之前");
        });
        player.onBeforePlay(function () {
            console.log("开始播放之前");
        });
        player.onBuffer(function(){
            console.log("开始缓冲");
        });
        player.onDisplayClick(function () {
            console.log("用户点击播放区域后");
        });
        player.onError(function () {
            console.log("播放器出错");
        });
        player.onFullscreen(function () {
            console.log("全屏");
        });
        player.onIdle(function () {
            console.log("状态变成空闲（idle）后");

        });
        player.onPause(function () {
            console.log(  player.id + " : 暂停播放");
            this.stop();
        });
        player.onPlay(function () {
            console.log(  player.id + " : 播放");

            for( i = 0; i < size; i++){

                if( player.id == playerid[i]){
                    playtable[i] = 1;
                }
            }

        });
        player.onPlaylistItem(function () {
            console.log("播放器当前播放条目变化");
        });
        player.onReady(function () {
            console.log("播放器初始化完成后的");
        });
        player.onSetupError(function () {
            console.log("播放器加载失败后");
        });
        player.onStop(function () {
            console.log("视频停止播放");
            for( i = 0; i < size; i++){

                if( player.id == playerid[i]){
                    playtable[i] = 0;
                }
            }

            this.remove();
        });
        /*
        player.onAlive(function () {
            console.log("监听直播流的状态，有直播流时触发");
        });
        player.onNoLiveStream(function () {
            console.log("监听直播流的状态，无直播流时触发");
        });
        */
     }

    function findUnused() {
     var index = 0;
     for(i=0; i< size ;i++) {
         if (playtable[i] == 0) {
             index = i + 1;
             playtable[i] = 1;
             current = index;
             break;
         }
     }
     if( index == 0){
         index = (current + 1)%size;
         if( index == 0)
             index = size;
         current = index;
     }
     var wind = "playercontainer"+index;
     console.log( wind );
     return wind;
 }
</script>

</body>
</html>